<!DOCTYPE html>
<html>
<head>
  <title>Teacher Result Entry - SJVM</title>
  <link rel="icon" href="assests/logo.png">
  <style>
    body {
      background: linear-gradient(to right, #0f2027, #203a43, #2c5364);
      color: white;
      font-family: Arial, sans-serif;
    }
    .container {
      max-width: 900px;
      margin: auto;
      padding: 20px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 15px;
    }
    h2 {
      text-align: center;
    }
    select, input, button {
      padding: 10px;
      margin: 5px;
      border-radius: 8px;
      border: none;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      padding: 10px;
      border: 1px solid #ccc;
      text-align: center;
    }
    .pass {
      background-color: #28a745;
    }
    .fail {
      background-color: #dc3545;
    }
    .step-section {
      margin-top: 30px;
    }
    .logo {
      display: block;
      margin: 10px auto;
      width: 100px;
    }
  </style>
</head>
<body>
  <div class="container">
    <img class="logo" src="assests/logo.png" alt="Logo">
    <h2>Teacher Result Entry - SJVM</h2>

    <label>Select Branch:</label>
    <select id="branch">
      <option value="">--Select Branch--</option>
      <option value="Atturu Layout">Atturu Layout</option>
      <option value="Bandikodigenahalli">Bandikodigenahalli</option>
    </select>

    <label>Enter Secret Code:</label>
    <input type="password" id="secretCode" placeholder="Enter Code">
    <button onclick="verifyCode()">Enter</button>

    <div id="resultForm" style="display:none">
      <hr>
      <label>Select Class:</label>
      <select id="class"></select>

      <label>Select Student:</label>
      <select id="student"></select>

      <div id="studentDetails"></div>

      <label>Select Exam:</label>
      <select id="exam">
        <option value="Midterm">Midterm</option>
        <option value="Final">Final</option>
      </select>

      <h3>Enter Subject-wise Marks</h3>
      <table id="marksTable">
        <thead>
          <tr>
            <th>Subject</th>
            <th>Max Marks</th>
            <th>Marks Obtained</th>
            <th>Internal Max</th>
            <th>Internal Obtained</th>
            <th>Final Grade</th>
            <th>Total Marks</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody id="subjectRows">
          <!-- JS will insert rows -->
        </tbody>
      </table>

      <div class="step-section">
        <h3>Overall Details</h3>
        <label>Total Max Marks: </label><input id="totalMax" type="number"><br>
        <label>Total Obtained: </label><input id="totalObtained" type="number"><br>
        <label>Percentage: </label><input id="percentage" type="text"><br>
        <label>Final Grade: </label><input id="finalGrade" type="text"><br>
        <label>Result: </label>
        <select id="finalResult">
          <option value="Pass">Pass</option>
          <option value="Fail">Fail</option>
        </select><br>
        <label>Updater Name: </label><input id="updater" type="text"><br>
        <button onclick="submitResult()">Submit Result</button>
      </div>
    </div>
  </div>

  <script>
    const students = {};

    async function verifyCode() {
      const branch = document.getElementById("branch").value;
      const code = document.getElementById("secretCode").value;
      if ((branch === 'Atturu Layout' && code === '0903') || (branch === 'Bandikodigenahalli' && code === '1103')) {
        document.getElementById("resultForm").style.display = "block";
        await loadStudents(branch);
      } else {
        alert("Invalid secret code!");
      }
    }

    async function loadStudents(branch) {
      const response = await fetch('https://raw.githubusercontent.com/Echoesofthe21stcentury/sjvm-schools/main/data/student_register.json');
      const data = await response.json();

      const classDropdown = document.getElementById("class");
      const studentDropdown = document.getElementById("student");
      classDropdown.innerHTML = '<option value="">--Select Class--</option>';
      const classes = new Set();

      for (let student of Object.values(data)) {
        if (student.branch === branch) {
          classes.add(student.class);
          if (!students[student.class]) students[student.class] = [];
          students[student.class].push(student);
        }
      }

      classes.forEach(cls => {
        classDropdown.innerHTML += `<option value="${cls}">${cls}</option>`;
      });

      classDropdown.onchange = function () {
        const selectedClass = this.value;
        studentDropdown.innerHTML = '<option value="">--Select Student--</option>';
        students[selectedClass].forEach(stu => {
          studentDropdown.innerHTML += `<option value="${stu.name}">${stu.name}</option>`;
        });
      };

      studentDropdown.onchange = function () {
        const name = this.value;
        const cls = classDropdown.value;
        const student = students[cls].find(s => s.name === name);
        document.getElementById("studentDetails").innerHTML = `Register No: <b>${student.regno}</b>`;
      };

      const subjects = ["Kannada", "English", "Maths", "Science", "Social", "Hindi"];
      const tbody = document.getElementById("subjectRows");
      subjects.forEach(sub => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${sub}</td>
          <td><input type="number"></td>
          <td><input type="number"></td>
          <td><input type="number"></td>
          <td><input type="number"></td>
          <td><input type="text"></td>
          <td><input type="number"></td>
          <td><select><option value="Pass">Pass</option><option value="Fail">Fail</option></select></td>
        `;
        tbody.appendChild(row);
      });
    }

    function submitResult() {
      alert("âœ… Result submitted successfully!\n(Note: Saving to GitHub backend requires GitHub API integration)");
    }
  </script>
</body>
</html>
