<!DOCTYPE html>
<html>
<head>
  <title>Register Students - SJVM</title>
  <style>
    body {
      font-family: Arial;
      background: #f2f2f2;
      padding: 40px;
    }
    form {
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      width: 400px;
      margin: auto;
      box-shadow: 0 0 10px #ccc;
    }
    input, select, button {
      display: block;
      width: 100%;
      padding: 8px;
      margin-top: 10px;
    }
    h2 {
      text-align: center;
      color: #333;
    }
  </style>
</head>
<body>
  <form id="registerForm">
    <h2>Register Student</h2>
    <input type="text" id="name" placeholder="Student Name" required>
    <input type="text" id="registerNumber" placeholder="Register Number" required>
    <select id="class" required>
      <option value="">Select Class</option>
      <option value="Class 1">Class 1</option>
      <option value="Class 2">Class 2</option>
      <option value="Class 3">Class 3</option>
      <option value="Class 4">Class 4</option>
      <option value="Class 5">Class 5</option>
      <option value="Class 6">Class 6</option>
      <option value="Class 7">Class 7</option>
      <option value="Class 8">Class 8</option>
      <option value="Class 9">Class 9</option>
      <option value="Class 10">Class 10</option>
    </select>
    <select id="branch" required>
      <option value="">Select Branch</option>
      <option value="Atturu">Atturu Layout</option>
      <option value="Bandikodigenahalli">Bandikodigenahalli</option>
    </select>
    <button type="submit">Register</button>
    <p id="msg"></p>
  </form>

  <script>
    const form = document.getElementById("registerForm");
    const msg = document.getElementById("msg");

    const GITHUB_TOKEN = "your_personal_access_token"; // replace
    const REPO = "sjvm-schools";
    const USERNAME = "Echoesofthe21stcentury";
    const FILE_PATH = "student_register.json";

    form.onsubmit = async (e) => {
      e.preventDefault();
      const student = {
        name: form.name.value,
        registerNumber: form.registerNumber.value,
        class: form.class.value,
        branch: form.branch.value,
      };

      const url = `https://api.github.com/repos/${USERNAME}/${REPO}/contents/${FILE_PATH}`;
      const headers = {
        Authorization: `Bearer ${GITHUB_TOKEN}`,
        "Content-Type": "application/json",
      };

      // Fetch current student_register.json content
      let currentData = [];
      let sha;
      try {
        const res = await fetch(url, { headers });
        const result = await res.json();
        sha = result.sha;
        currentData = JSON.parse(atob(result.content));
      } catch (err) {
        console.log("New file will be created.");
      }

      currentData.push(student);

      const newContent = btoa(JSON.stringify(currentData, null, 2));
      const body = {
        message: `Add student ${student.registerNumber}`,
        content: newContent,
        sha,
      };

      const response = await fetch(url, {
        method: "PUT",
        headers,
        body: JSON.stringify(body),
      });

      if (response.ok) {
        msg.textContent = "✅ Student registered!";
        form.reset();
      } else {
        msg.textContent = "❌ Failed to register student.";
      }
    };
  </script>
</body>
</html>
