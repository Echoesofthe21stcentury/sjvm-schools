<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Assign Users ‚Äì SJVM</title>

  <script>
    const role = localStorage.getItem("role");
    const userid = localStorage.getItem("userid");

    const allowedRoles = ["Principal", "Admin", "Chairman"];

    if (!userid || !allowedRoles.includes(role)) {
      alert("Access Denied. Please log in.");
      window.location.href = "userlogin.html";
    } else {
      if (!sessionStorage.getItem("access_granted")) {
        const code = prompt("üîê Enter Access Code:");
        if (code !== "2011") {
          alert("Incorrect Code. Access Denied.");
          window.location.href = "userlogin.html";
        } else {
          sessionStorage.setItem("access_granted", "true");
        }
      }
    }
  </script>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f8fc;
      margin: 0;
      padding: 20px;
    }

    h1 {
      color: #003366;
      text-align: center;
    }

    label {
      display: block;
      margin-top: 15px;
      font-weight: bold;
    }

    input, select {
      width: 100%;
      max-width: 400px;
      padding: 10px;
      margin-top: 5px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }

    button {
      margin-top: 20px;
      background: #0059b3;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }

    button:hover {
      background: #003366;
    }

    textarea {
      margin-top: 20px;
      width: 100%;
      height: 300px;
      padding: 10px;
      font-family: monospace;
      font-size: 14px;
    }
  </style>
</head>
<body>

  <h1>üë• Assign New User</h1>

  <label for="role">Select Role:</label>
  <select id="role">
    <option value="">-- Select Role --</option>
    <option value="Student">Student</option>
    <option value="Teacher">Teacher</option>
    <option value="Coordinator">Coordinator</option>
    <option value="Admin">Admin</option>
    <option value="Principal">Principal</option>
    <option value="Chairman">Chairman</option>
  </select>

  <label for="class">Class (Only for Students):</label>
  <input type="text" id="class" placeholder="e.g. Class 5 or leave empty for other roles" />

  <label for="branch">Branch:</label>
  <select id="branch">
    <option value="">-- Select Branch --</option>
    <option value="Bandikodigenahalli">Bandikodigenahalli</option>
    <option value="Atturu Layout">Atturu Layout</option>
  </select>

  <label for="userid">User ID:</label>
  <input type="text" id="userid" placeholder="e.g. STU-001" />

  <label for="name">Full Name:</label>
  <input type="text" id="name" />

  <label for="password">Password:</label>
  <input type="text" id="password" />

  <button onclick="addUser()">‚ûï Add to users.json</button>

  <h2>üìÅ users.json (Preview)</h2>
  <textarea id="jsonOutput" readonly></textarea>

  <button onclick="downloadJSON()">üì• Download users.json</button>

  <script>
    let users = {};

    function addUser() {
      const role = document.getElementById("role").value;
      const userid = document.getElementById("userid").value.trim();
      const name = document.getElementById("name").value.trim();
      const password = document.getElementById("password").value.trim();
      const userClass = document.getElementById("class").value.trim();
      const branch = document.getElementById("branch").value.trim();

      if (!role || !userid || !name || !password || !branch) {
        alert("Please fill in all required fields.");
        return;
      }

      if (role === "Student" && !userClass) {
        alert("Please provide class for student.");
        return;
      }

      if (!users[role]) users[role] = {};

      if (role === "Student") {
        if (!users[role][userClass]) users[role][userClass] = {};
        if (!users[role][userClass][userid]) {
          users[role][userClass][userid] = {
            name,
            password,
            class: userClass,
            branch
          };
        }
      } else {
        if (!users[role][userid]) {
          users[role][userid] = {
            name,
            password,
            branch
          };
        }
      }

      document.getElementById("jsonOutput").value = JSON.stringify(users, null, 2);

      // Clear fields
      document.getElementById("userid").value = "";
      document.getElementById("name").value = "";
      document.getElementById("password").value = "";
      document.getElementById("class").value = "";
    }

    function downloadJSON() {
      const blob = new Blob([JSON.stringify(users, null, 2)], { type: "application/json" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "users.json";
      a.click();
    }
  </script>

</body>
</html>
