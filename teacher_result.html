<!DOCTYPE html>
<html>
<head>
  <title>Register Student - SJVM</title>
  <style>
    body {
      background-color: #0d1b2a;
      color: #ffffff;
      font-family: 'Segoe UI', sans-serif;
      padding: 30px;
      text-align: center;
    }

    input, select, button {
      padding: 10px;
      margin: 10px;
      font-size: 16px;
      border-radius: 6px;
      border: none;
    }

    .form-box {
      background-color: #1b263b;
      padding: 30px;
      border-radius: 10px;
      display: inline-block;
      box-shadow: 0 0 15px #415a77;
    }

    .status {
      margin-top: 15px;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>SJVM Student Registration</h1>

  <div class="form-box">
    <input type="text" id="studentName" placeholder="Student Name" required><br>
    <select id="studentClass">
      <option value="">Select Class</option>
      <option>PKG</option><option>LKG</option><option>UKG</option>
      <option>Class 1</option><option>Class 2</option><option>Class 3</option>
      <option>Class 4</option><option>Class 5</option><option>Class 6</option>
      <option>Class 7</option><option>Class 8</option><option>Class 9</option>
      <option>Class 10</option>
    </select><br>
    <input type="text" id="registerNumber" placeholder="Register Number (e.g., SBK-401)" required><br>
    <select id="branch">
      <option value="">Select Branch</option>
      <option value="Atturu">Atturu</option>
      <option value="Bandikodigenahalli">Bandikodigenahalli</option>
    </select><br>

    <button onclick="registerStudent()">Submit</button>
    <div class="status" id="statusMessage"></div>
  </div>

  <script>
    async function registerStudent() {
      const name = document.getElementById("studentName").value.trim();
      const studentClass = document.getElementById("studentClass").value;
      const regNo = document.getElementById("registerNumber").value.trim();
      const branch = document.getElementById("branch").value;

      if (!name || !studentClass || !regNo || !branch) {
        document.getElementById("statusMessage").innerText = "❌ Please fill all fields.";
        return;
      }

      const newEntry = {
        name: name,
        class: studentClass,
        registerNumber: regNo,
        branch: branch
      };

      const repo = "Echoesofthe21stcentury/sjvm-schools";
      const filePath = "backend/student_register.json";
      const token = "ghp_your_token_here"; // replace with your GitHub personal access token

      const apiUrl = `https://api.github.com/repos/${repo}/contents/${filePath}`;

      // Step 1: Get current file content
      const response = await fetch(apiUrl, {
        headers: {
          Authorization: `Bearer ${token}`,
          Accept: "application/vnd.github.v3+json"
        }
      });

      let currentData = [];
      let sha = "";

      if (response.ok) {
        const data = await response.json();
        currentData = JSON.parse(atob(data.content));
        sha = data.sha;
      }

      currentData.push(newEntry);

      const updatedContent = btoa(JSON.stringify(currentData, null, 2));

      // Step 2: Update file
      const updateRes = await fetch(apiUrl, {
        method: "PUT",
        headers: {
          Authorization: `Bearer ${token}`,
          Accept: "application/vnd.github.v3+json"
        },
        body: JSON.stringify({
          message: `Added student ${name}`,
          content: updatedContent,
          sha: sha
        })
      });

      if (updateRes.ok) {
        document.getElementById("statusMessage").innerText = `✅ ${name} registered successfully!`;
      } else {
        document.getElementById("statusMessage").innerText = "❌ Failed to register student.";
      }
    }
  </script>
</body>
</html>
