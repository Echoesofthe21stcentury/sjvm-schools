<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Student Register - SJVM</title>
  <style>
    body {
      background: linear-gradient(to right, #1e3c72, #2a5298);
      font-family: 'Segoe UI', sans-serif;
      color: #fff;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 30px;
    }
    h1 {
      color: #fcd34d;
    }
    form {
      background: #0f172a;
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 0 20px #00000088;
      width: 320px;
    }
    input, select, button {
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      border-radius: 8px;
      border: none;
      font-size: 14px;
    }
    input, select {
      background: #1e293b;
      color: #fff;
    }
    button {
      background: #22c55e;
      color: #fff;
      cursor: pointer;
      transition: background 0.3s;
    }
    button:hover {
      background: #16a34a;
    }
  </style>
</head>
<body>

  <h1>Student Registration</h1>
  <form id="studentForm">
    <input type="text" id="regno" placeholder="Register Number" required />
    <input type="text" id="name" placeholder="Full Name" required />
    <input type="text" id="father" placeholder="Father's Name" required />
    <input type="text" id="mobile" placeholder="Mobile Number" required />
    <input type="text" id="address" placeholder="Address" required />
    <select id="class" required>
      <option value="">Select Class</option>
      <option value="Class 1">Class 1</option>
      <option value="Class 2">Class 2</option>
      <!-- Add more classes as needed -->
    </select>
    <select id="branch" required>
      <option value="">Select Branch</option>
      <option value="Bandikodigenahalli">Bandikodigenahalli</option>
      <option value="Atturu Layout">Atturu Layout</option>
    </select>
    <button type="submit">Register</button>
  </form>

  <script>
    const filePath = "data/student_register.json";

    async function updateGitHubFile(filePath, modifyCallback, commitMsg, token) {
      const url = `https://api.github.com/repos/Echoesofthe21stcentury/sjvm-schools/contents/${filePath}`;
      
      const response = await fetch(url, {
        headers: {
          Authorization: `token ${token}`,
          Accept: "application/vnd.github.v3+json"
        }
      });

      if (!response.ok) {
        throw new Error("Failed to fetch file: " + response.status);
      }

      const file = await response.json();
      const sha = file.sha;
      const content = atob(file.content);
      const data = JSON.parse(content);
      const updatedData = modifyCallback(data);
      const newContent = btoa(JSON.stringify(updatedData, null, 2));

      return await fetch(url, {
        method: "PUT",
        headers: {
          Authorization: `token ${token}`,
          Accept: "application/vnd.github.v3+json"
        },
        body: JSON.stringify({
          message: commitMsg,
          content: newContent,
          sha
        })
      });
    }

    document.getElementById("studentForm").addEventListener("submit", async function (e) {
      e.preventDefault();

      const regno = document.getElementById("regno").value.trim();
      const name = document.getElementById("name").value.trim();
      const father = document.getElementById("father").value.trim();
      const mobile = document.getElementById("mobile").value.trim();
      const address = document.getElementById("address").value.trim();
      const classValue = document.getElementById("class").value;
      const branch = document.getElementById("branch").value;

      const token = prompt("üîê Enter your GitHub OTT (Personal Access Token):");
      if (!token) return alert("‚ùå Token is required!");

      const newStudent = {
        regno,
        name,
        father,
        mobile,
        address,
        class: classValue,
        branch
      };

      try {
        const response = await updateGitHubFile(
          filePath,
          (data) => {
            data.push(newStudent);
            return data;
          },
          `üìò New student registered: ${regno}`,
          token
        );

        if (response.ok) {
          alert("‚úÖ Student registered successfully!");
          document.getElementById("studentForm").reset();
        } else {
          const error = await response.json();
          alert("‚ùå Error updating file: " + error.message);
        }
      } catch (err) {
        alert("‚ö†Ô∏è Error: " + err.message);
      }
    });
  </script>

</body>
</html>
